(()=>{var te=Object.defineProperty;var v=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var D=(k,d,l)=>d in k?te(k,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):k[d]=l,$=(k,d)=>{for(var l in d||(d={}))oe.call(d,l)&&D(k,l,d[l]);if(v)for(var l of v(d))ce.call(d,l)&&D(k,l,d[l]);return k};var C=(k,d,l)=>new Promise((U,g)=>{var I=p=>{try{f(l.next(p))}catch(w){g(w)}},R=p=>{try{f(l.throw(p))}catch(w){g(w)}},f=p=>p.done?U(p.value):Promise.resolve(p.value).then(I,R);f((l=l.apply(k,d)).next())});var ne=function(){"use strict";function k({checkout:e,checkoutUserErrors:o}){const{id:n,webUrl:r,completedAt:s,lineItems:h,discountApplications:c}=e!=null?e:{id:null,webUrl:null,lineItems:{edges:[]},discountApplications:{edges:[]}};return{id:n,url:r,completed:Boolean(s),lines:h.edges.map(t=>t.node),discounts:c.edges.map(t=>t.node),shopifyErrors:o}}function d({cartItems:e}){return e.map(n=>{const{quantity:r,variantId:s}=n,h=S(s);return{customAttributes:A({metafields:n.metafields}),quantity:r,variantId:h}})}function l(e){var n,r;return((r=(n=e==null?void 0:e.split(".myshopify").shift())==null?void 0:n.split("//").pop())==null?void 0:r.split(".").pop())||e}const U="[@nacelle/shopify-checkout] in order to create a checkout server-side, you must provide a fetch API-compatible `fetchClient` capable of running on both the client & server. Examples include `isomorphic-unfetch` and `cross-fetch`.",g="[@nacelle/shopify-checkout]: missing required parameters. You must provide a `myshopifyDomain` or a `customEndpoint`.",I="[@nacelle/shopify-checkout]: missing required parameter `storefrontCheckoutToken`.";function R({customEndpoint:e,fetchClient:o,myshopifyDomain:n,storefrontCheckoutToken:r}){return({query:h,variables:c})=>{let t=e||"";if(!r)throw new Error(I);if(!t){if(!n)throw new Error(g);t=`https://${l(n||"")}.myshopify.com/api/2022-01/graphql`}let i=o;if(!i)if(typeof window!="undefined")i=window.fetch;else throw new Error(U);return i(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Shopify-Storefront-Access-Token":r},body:JSON.stringify({query:h,variables:c})}).then(u=>u.json())}}function f(e,...o){return e.reduce((n,r,s)=>`${n}${r}${o[s]||""}`,"")}function p(e,{caller:o,message:n}={}){let r="";throw o&&(r=`[${o}] `),r=r+(n||"Shopify Storefront API Errors:")+(e?`
`+JSON.stringify(e,null,2):""),new Error(r)}function w(e){return(e==null?void 0:e.length)?e.includes("Z2lkOi8vc2hvcGlmeS9DaGVja291dC")&&e!=="":!1}function A({metafields:e}){return!Array.isArray(e)||!(e==null?void 0:e.length)?[]:e==null?void 0:e.reduce((n,r)=>(typeof r.value=="string"?n.push({key:r.key,value:r.value}):console.warn(`Omitting custom attribute "${r.key}" because it has a non-string value.`),n),[])}function S(e){if(b(e))return e;if(_(e))return O(e);const o=V(e);if(b(o))return o;throw Error(`${e} is an invalid shopify variant id`)}function b(e){return e.startsWith("gid://shopify/")}function _(e){return!Number.isNaN(Number(e))}function V(e){try{return typeof window=="undefined"?Buffer.from(e,"base64").toString("base64")===e?Buffer.from(e,"base64").toString():e:window.atob(e)}catch(o){return e}}function O(e){return`gid://shopify/ProductVariant/${e}`}const T=f`fragment CheckoutLineItem_lineItem on CheckoutLineItem { customAttributes { key value } discountAllocations { allocatedAmount { amount currencyCode } } id quantity title unitPrice { amount currencyCode } variant { id } }`,q=f`fragment DiscountApplication_discountApplication on DiscountApplication { allocationMethod targetSelection targetType ... on ScriptDiscountApplication { title } value { ... on MoneyV2 { amount currencyCode } ... on PricingPercentageValue { percentage } } }`,L=f`fragment Checkout_checkout on Checkout { id webUrl lineItems(first: 100) { edges { node { ...CheckoutLineItem_lineItem } } } discountApplications(first: 100) { edges { node { ...DiscountApplication_discountApplication } } } }${T}${q}`,P=f`fragment CheckoutUserError_checkoutUserError on CheckoutUserError { code field message }`;var E={CHECKOUT:L,USER_ERROR:P};const B=f`mutation checkoutCreate($input: CheckoutCreateInput!) { checkoutCreate(input: $input) { checkout { ...Checkout_checkout } checkoutUserErrors { ...CheckoutUserError_checkoutUserError } } }${E.CHECKOUT}${E.USER_ERROR}`,G=f`mutation checkoutLineItemsReplace( $lineItems: [CheckoutLineItemInput!]! $checkoutId: ID! ) { checkoutLineItemsReplace(lineItems: $lineItems, checkoutId: $checkoutId) { checkout { ...Checkout_checkout } userErrors { ...CheckoutUserError_checkoutUserError } } }${E.CHECKOUT}${E.USER_ERROR}`,H=f`mutation checkoutAttributesUpdate( $checkoutId: ID! $input: CheckoutAttributesUpdateV2Input! ) { checkoutAttributesUpdateV2(checkoutId: $checkoutId, input: $input) { checkout { ...Checkout_checkout } checkoutUserErrors { ...CheckoutUserError_checkoutUserError } } }${E.CHECKOUT}${E.USER_ERROR}`,K=f`mutation checkoutDiscountCodeApplyV2( $checkoutId: ID! $discountCode: String! ) { checkoutDiscountCodeApplyV2( checkoutId: $checkoutId discountCode: $discountCode ) { checkout { ...Checkout_checkout } checkoutUserErrors { ...CheckoutUserError_checkoutUserError } } }${E.CHECKOUT}${E.USER_ERROR}`,N=f`mutation checkoutDiscountCodeRemove($checkoutId: ID!) { checkoutDiscountCodeRemove(checkoutId: $checkoutId) { checkout { ...Checkout_checkout } checkoutUserErrors { ...CheckoutUserError_checkoutUserError } } }${E.CHECKOUT}${E.USER_ERROR}`;function j(s){return C(this,arguments,function*({gqlClient:e,id:o,customAttributes:n,note:r}){const h=H,c={checkoutId:o,input:{customAttributes:n,note:r}},{data:t,errors:i}=yield e({query:h,variables:c}).catch(a=>{throw new Error(a)}),u=i||(t==null?void 0:t.checkoutAttributesUpdateV2.checkoutUserErrors);if((u==null?void 0:u.length)&&p(u,{caller:"checkoutAttributesUpdate"}),t==null?void 0:t.checkoutAttributesUpdateV2.checkout)return k(t.checkoutAttributesUpdateV2)})}function x(h){return C(this,arguments,function*({gqlClient:e,lineItems:o,customAttributes:n,note:r,queueToken:s}){const c=B,t={input:{customAttributes:n,lineItems:o,note:r},queueToken:s};try{const{data:i,errors:u}=yield e({query:c,variables:t}).catch(y=>{throw new Error(y)}),a=u||(i==null?void 0:i.checkoutCreate.checkoutUserErrors);if((a==null?void 0:a.length)&&p(u,{caller:"checkoutCreate"}),i==null?void 0:i.checkoutCreate.checkout)return k(i.checkoutCreate)}catch(i){throw new Error(String(i))}})}function M(r){return C(this,arguments,function*({gqlClient:e,lineItems:o,id:n}){const s=G,h={checkoutId:n,lineItems:o},{data:c,errors:t}=yield e({query:s,variables:h}).catch(u=>{throw new Error(u)}),i=t||(c==null?void 0:c.checkoutLineItemsReplace.userErrors);if((i==null?void 0:i.length)&&p(i,{caller:"checkoutLineItemsReplace"}),c==null?void 0:c.checkoutLineItemsReplace.checkout)return k({checkout:c==null?void 0:c.checkoutLineItemsReplace.checkout,checkoutUserErrors:c==null?void 0:c.checkoutLineItemsReplace.userErrors})})}const z=f`query getCheckout($id: ID!) { node(id: $id) { ... on Checkout { ...Checkout_checkout } } }${E.CHECKOUT}`;function J(n){return C(this,arguments,function*({gqlClient:e,id:o}){const r=z,s={id:o},{data:h,errors:c}=yield e({query:r,variables:s}).catch(t=>{throw new Error(t)});if(c&&p(c,{caller:"findCheckout"}),!(h==null?void 0:h.node))p(void 0,{caller:"findCheckout",message:"Checkout response has no data"});else return k({checkout:h.node,checkoutUserErrors:[]})})}function W(c){return C(this,arguments,function*({gqlClient:e,id:o,lineItems:n,customAttributes:r,note:s,queueToken:h}){let t;const i=n==null?void 0:n.length,u=(r==null?void 0:r.length)||s;try{if(o){if(!w(o))throw new Error(`Invalid checkout ID. Expected a Base64-encoded Shopify Global ID. Received: ${o}`);const a=[];i&&a.push(M({gqlClient:e,id:o,lineItems:n})),u&&a.push(j({gqlClient:e,id:o,customAttributes:r,note:s})),yield Promise.allSettled(a).then(y=>y.forEach(m=>{if(m.status==="fulfilled"&&m.value)t=$($({},t||{}),m.value);else if(m.status==="rejected")throw new Error(m.reason)}))}return typeof t=="undefined"&&typeof n!="undefined"&&(t=yield x({gqlClient:e,customAttributes:r,note:s,lineItems:n,queueToken:h})),t}catch(a){throw new Error(String(a))}})}function X(s){return C(this,arguments,function*({gqlClient:e,id:o,discountCode:n,queueToken:r}){const h=K,c={input:{checkoutId:o,discountCode:n},queueToken:r};try{if(!w(o))throw new Error(`Invalid checkout ID. Expected a Base64-encoded Shopify Global ID. Received: ${o}`);const{data:t,errors:i}=yield e({query:h,variables:c}).catch(a=>{throw new Error(a)}),u=i||(t==null?void 0:t.checkoutDiscountCodeApplyV2.checkoutUserErrors);if((u==null?void 0:u.length)&&p(u,{caller:"checkoutDiscountCodeApplyV2"}),t==null?void 0:t.checkoutDiscountCodeApplyV2.checkout)return k(t.checkoutDiscountCodeApplyV2)}catch(t){throw new Error(String(t))}})}function Y(r){return C(this,arguments,function*({gqlClient:e,id:o,queueToken:n}){const s=N,h={input:{checkoutId:o},queueToken:n};try{if(!w(o))throw new Error(`Invalid checkout ID. Expected a Base64-encoded Shopify Global ID. Received: ${o}`);const{data:c,errors:t}=yield e({query:s,variables:h}).catch(u=>{throw new Error(u)}),i=t||(c==null?void 0:c.checkoutDiscountCodeRemove.checkoutUserErrors);if((i==null?void 0:i.length)&&p(i,{caller:"checkoutDiscountCodeRemove"}),c==null?void 0:c.checkoutDiscountCodeRemove.checkout)return k(c.checkoutDiscountCodeRemove)}catch(c){throw new Error(String(c))}})}function Z({storefrontCheckoutToken:e,myshopifyDomain:o,customEndpoint:n,fetchClient:r}){const s=R({customEndpoint:n,fetchClient:r,myshopifyDomain:o,storefrontCheckoutToken:e});function h(a){return C(this,arguments,function*({id:u}){return yield J({gqlClient:s,id:u})})}function c(ie){return C(this,arguments,function*({cartItems:u,id:a,metafields:y,note:m,queueToken:F}){const Q=(u==null?void 0:u.length)?d({cartItems:u}):void 0,ee=(y==null?void 0:y.length)?A({metafields:y}):void 0;return yield W({gqlClient:s,lineItems:Q,id:a,customAttributes:ee,note:m,queueToken:F})})}function t(m){return C(this,arguments,function*({id:u,discountCode:a,queueToken:y}){return yield X({gqlClient:s,id:u,discountCode:a,queueToken:y})})}function i(y){return C(this,arguments,function*({id:u,queueToken:a}){return yield Y({gqlClient:s,id:u,queueToken:a})})}return{get:h,process:c,discountApply:t,discountRemove:i}}return Z}();})();
//# sourceMappingURL=boll-branch-shopify-checkout.iife.js.map
